<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · FlexPlan</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">FlexPlan</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#.-Import-packages"><span>1. Import packages</span></a></li><li><a class="tocitem" href="#.-Input-data"><span>2. Input data</span></a></li><li><a class="tocitem" href="#.-Solve-the-problem"><span>3. Solve the problem</span></a></li><li><a class="tocitem" href="#.-Inspect-your-results"><span>4. Inspect your results</span></a></li></ul></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../problem_types/">Problem types</a></li><li><a class="tocitem" href="../network_formulations/">Network formulations</a></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Multiperiod, multistage modelling</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../modeling_assumptions/">Modelling assumptions</a></li><li><a class="tocitem" href="../dimensions/">Model dimensions</a></li></ul></li><li><a class="tocitem" href="../data_model/">Data model</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Electa-Git/FlexPlan.jl/blob/master/docs/src/tutorial.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><p>This page shows how to define and solve network planning problems using FlexPlan.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>Before following this tutorial you might want to have a look at some <a href="../examples/#Examples">examples</a>.</p></div></div><h2 id=".-Import-packages"><a class="docs-heading-anchor" href="#.-Import-packages">1. Import packages</a><a id=".-Import-packages-1"></a><a class="docs-heading-anchor-permalink" href="#.-Import-packages" title="Permalink"></a></h2><p>FlexPlan builds on <a href="https://github.com/lanl-ansi/PowerModels.jl">PowerModels</a> and <a href="https://github.com/Electa-Git/PowerModelsACDC.jl">PowerModelsACDC</a> packages. You can declare the packages as follows, and use short names to access specific functions without having to type the full package name every time.</p><pre><code class="language-julia hljs">import PowerModels as _PM
import PowerModelsACDC as _PMACDC
import FlexPlan as _FP</code></pre><p>Any other additional package that you might need, e.g., for printing, plotting, exporting results etc. can be declared in the same way.</p><p>Also, the solution of the optimization problem will require an MILP solver. As FlexPlan depends on <a href="https://github.com/jump-dev/JuMP.jl">JuMP</a> package, it can be interfaced with any of the <a href="https://jump.dev/JuMP.jl/stable/installation/#Supported-solvers">optimisation solvers supported by JuMP</a>. You can declare and initialize the solver as follows:</p><pre><code class="language-julia hljs">import HiGHS
optimizer = _FP.optimizer_with_attributes(HiGHS.Optimizer, &quot;output_flag&quot;=&gt;false)</code></pre><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>FlexPlan exports <code>JuMP.optimizer_with_attributes</code> function, so you don&#39;t have to import JuMP just to use this function.</p></div></div><h2 id=".-Input-data"><a class="docs-heading-anchor" href="#.-Input-data">2. Input data</a><a id=".-Input-data-1"></a><a class="docs-heading-anchor-permalink" href="#.-Input-data" title="Permalink"></a></h2><p>The data model of FlexPlan is very similar to the ones of PowerModels/PowerModelsACDC. As such, a data dictionary containing all information is passed to the optimisation problem. The standard network elements such as generators, buses, branches, etc. are extended with the existing and candidate storage and demand flexibility elements (see section <a href="../data_model/#Data-model">Data model</a> for complete description). The multi-network modelling functionality of PowerModels is used to represent the different number of scenarios, planning years and planning hours within the year. The procedure is further explained under section <a href="../dimensions/#Model-dimensions">Model dimensions</a>.</p><h3 id="FlexPlan.jl-sample-data"><a class="docs-heading-anchor" href="#FlexPlan.jl-sample-data">FlexPlan.jl sample data</a><a id="FlexPlan.jl-sample-data-1"></a><a class="docs-heading-anchor-permalink" href="#FlexPlan.jl-sample-data" title="Permalink"></a></h3><p>The package contains some sample test cases comprising both grid data and multi-scenario time series, located under <a href="https://github.com/Electa-Git/FlexPlan.jl/tree/master/test/data"><code>/test/data/</code></a> and named as its subdirectories. These test cases have been used in for the validation of the model in the FlexPlan deliverable 1.2 <a href="https://flexplan-project.eu/wp-content/uploads/2022/08/D1.2_20220801_V2.0.pdf">&quot;Probabilistic optimization of T&amp;D systems planning with high grid flexibility and its scalability&quot;</a>.</p><p><a href="https://github.com/Electa-Git/FlexPlan.jl/blob/master/test/io/load_case.jl"><code>/test/io/load_case.jl</code></a> provides functions to load such test cases. The functions are named <code>load_*</code> where <code>*</code> is the name of a test case. For example, <code>case6</code> can be loaded using:</p><pre><code class="language-julia hljs">const _FP_dir = dirname(dirname(pathof(_FP))) # Root directory of FlexPlan package
include(joinpath(_FP_dir,&quot;test/io/load_case.jl&quot;))
data = load_case6(; number_of_hours=24, number_of_scenarios=1, number_of_years=1)</code></pre><p>Supported parameters are explained in <code>load_*</code> function documentation: in a Julia REPL, type <code>?</code> followed by a function name to read its documentation.</p><h3 id="Using-your-own-data"><a class="docs-heading-anchor" href="#Using-your-own-data">Using your own data</a><a id="Using-your-own-data-1"></a><a class="docs-heading-anchor-permalink" href="#Using-your-own-data" title="Permalink"></a></h3><p>FlexPlan provides functions that facilitate the construction of a multinetwork data dictionary using:</p><ul><li>network data from Matpower-like <code>.m</code> files;</li><li>time series data from dictionaries of vectors, each vector being a time series.</li></ul><p>The procedure is as follows.</p><ol><li>Create a single-network data dictionary.<ol><li>Load network data from Matpower-like <code>.m</code> files (see e.g. <a href="https://github.com/Electa-Git/FlexPlan.jl/blob/master/test/data/case6/case6_2030.m"><code>/test/data/case6/case6_2030.m</code></a>). Use <code>parse_file</code>.</li><li>Specify the dimensions of the data. Use <code>add_dimension!</code>.</li><li>Scale costs and lifetime of grid expansion elements. Use <code>scale_data!</code>.</li></ol></li><li>Create a dictionary of vectors that contains time series. You have to write your own code for performing this step.</li><li>Create a multinetwork data dictionary by combining the single-network data dictionary and the time series. Use <code>make_multinetwork</code>.</li></ol><p>Here is some sample code to get started:</p><pre><code class="language-julia hljs">const _FP_dir = dirname(dirname(pathof(_FP))) # Root directory of FlexPlan package
sn_data = _FP.parse_file(joinpath(_FP_dir,&quot;test/data/case6/case6_2030.m&quot;))
_FP.add_dimension!(sn_data, :hour, 24)
_FP.add_dimension!(sn_data, :scenario, Dict(1 =&gt; Dict{String,Any}(&quot;probability&quot;=&gt;1)))
_FP.add_dimension!(sn_data, :year, 1; metadata = Dict{String,Any}(&quot;scale_factor&quot;=&gt;1))
_FP.scale_data!(sn_data)

include(joinpath(_FP_dir,&quot;test/io/create_profile.jl&quot;)) # Functions to load sample time series. Use your own instead.
sn_data, loadprofile, genprofile = create_profile_data_italy!(sn_data)
time_series = create_profile_data(24, sn_data, loadprofile, genprofile) # Your time series should have the same format as this `time_series` dict

mn_data = _FP.make_multinetwork(sn_data, time_series)</code></pre><h3 id="Coupling-of-transmission-and-distribution-networks"><a class="docs-heading-anchor" href="#Coupling-of-transmission-and-distribution-networks">Coupling of transmission and distribution networks</a><a id="Coupling-of-transmission-and-distribution-networks-1"></a><a class="docs-heading-anchor-permalink" href="#Coupling-of-transmission-and-distribution-networks" title="Permalink"></a></h3><p>FlexPlan provides the possiblity to couple multiple radial distribution networks to the transmission system, for solving the combined T&amp;D grid expansion problem. For the meshed transmission system the linearized &#39;DC&#39; power flow formulation is used, whereas radial networks are modelled using the linearized DistFlow model (more information can be found under <a href="../network_formulations/#Network-formulations">Network formulations</a> section).</p><p>Input data consist of:</p><ul><li>one dictionary for the trasmission network;</li><li>a vector of dictionaries, each item representing one distribution network.</li></ul><p>The only difference with respect to the case of a single network is that for each distribution network it is necessary to specify which bus of the transmission network it is to be attached to. This is done by adding a <code>t_bus</code> key in the distribution network dictionary.</p><p>Here is an example (using FlexPlan sample data):</p><pre><code class="language-julia hljs">number_of_hours = 4
number_of_scenarios = 2
number_of_years = 1
const _FP_dir = dirname(dirname(pathof(_FP))) # Root directory of FlexPlan package
include(joinpath(_FP_dir, &quot;test/io/load_case.jl&quot;))

# Transmission network data
t_data = load_case6(; number_of_hours, number_of_scenarios, number_of_years)

# Distribution network 1 data
d_data_sub_1 = load_ieee_33(; number_of_hours, number_of_scenarios, number_of_years)
d_data_sub_1[&quot;t_bus&quot;] = 3 # States that this distribution network is attached to bus 3 of transmission network

# Distribution network 2 data
d_data_sub_2 = deepcopy(d_data_sub_1)
d_data_sub_2[&quot;t_bus&quot;] = 6

d_data = [d_data_sub_1, d_data_sub_2]</code></pre><h2 id=".-Solve-the-problem"><a class="docs-heading-anchor" href="#.-Solve-the-problem">3. Solve the problem</a><a id=".-Solve-the-problem-1"></a><a class="docs-heading-anchor-permalink" href="#.-Solve-the-problem" title="Permalink"></a></h2><p>Finally, the problem can be solved using (example of stochastic planning problem with storage &amp; demand flexiblity candidates):</p><pre><code class="language-julia hljs">result = _FP.simple_stoch_flex_tnep(data, _PM.DCPPowerModel, optimizer; setting=Dict(&quot;conv_losses_mp&quot;=&gt;false))</code></pre><p>of, for the combined T&amp;D model:</p><pre><code class="language-julia hljs">result = _FP.simple_stoch_flex_tnep(t_data, d_data, _PM.DCPPowerModel, _FP.BFARadPowerModel, optimizer; t_setting=Dict(&quot;conv_losses_mp&quot;=&gt;false))</code></pre><p>For other possible problem types and decomposed models, please check the <a href="../problem_types/#Problem-types">Problem types</a> section.</p><h2 id=".-Inspect-your-results"><a class="docs-heading-anchor" href="#.-Inspect-your-results">4. Inspect your results</a><a id=".-Inspect-your-results-1"></a><a class="docs-heading-anchor-permalink" href="#.-Inspect-your-results" title="Permalink"></a></h2><p>The optimization results are returned as a Julia <code>Dict</code>, so you can easily write your custom code to retrieve the results you need. However some basic functions for displaying and exporting results are provided in the package.</p><h3 id="Check-termination-status"><a class="docs-heading-anchor" href="#Check-termination-status">Check termination status</a><a id="Check-termination-status-1"></a><a class="docs-heading-anchor-permalink" href="#Check-termination-status" title="Permalink"></a></h3><p>First thing to do is check the <a href="https://jump.dev/JuMP.jl/stable/moi/manual/solutions/">termination status</a> of the solver to make sure that an optimal solution has been found.</p><p>You may want to check the value of <code>&quot;termination_status&quot;</code> like this:</p><pre><code class="language-julia hljs">@assert result[&quot;termination_status&quot;] ∈ (_FP.OPTIMAL, _FP.LOCALLY_SOLVED) &quot;$(result[&quot;optimizer&quot;]) termination status: $(result[&quot;termination_status&quot;])&quot;</code></pre><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>FlexPlan exports JuMP&#39;s <code>TerminationStatusCode</code> and <code>ResultStatusCode</code>, so you can access these types as above, without having to import JuMP just for that.</p></div></div><h3 id="Check-solve-time"><a class="docs-heading-anchor" href="#Check-solve-time">Check solve time</a><a id="Check-solve-time-1"></a><a class="docs-heading-anchor-permalink" href="#Check-solve-time" title="Permalink"></a></h3><p>The total solve time is also available, under <code>&quot;solve_time&quot;</code>:</p><pre><code class="language-julia hljs">println(&quot;Total solve time: $(round(result[&quot;solve_time&quot;], digits=1)) seconds.&quot;)</code></pre><h3 id="Access-solution"><a class="docs-heading-anchor" href="#Access-solution">Access solution</a><a id="Access-solution-1"></a><a class="docs-heading-anchor-permalink" href="#Access-solution" title="Permalink"></a></h3><p>To obtain power flow results, you can use the <code>print_summary</code> and <code>component_table</code> functions of PowerModels.</p><p>Further, several functions are provided to access to optimal investments and costs by category, view power profiles, and display the network topology. Generally, they return a <a href="https://dataframes.juliadata.org/stable/">DataFrame</a>. They also allow you to save numerical results as CSV files and plots in any format supported by <a href="https://docs.juliaplots.org/stable/">Plots.jl</a>. All these functions are contained in <a href="https://github.com/Electa-Git/FlexPlan.jl/blob/master/test/io/sol.jl"><code>/test/io/sol.jl</code></a>, but are not part of FlexPlan module to avoid unwanted dependencies. Include them with</p><pre><code class="language-julia hljs">const _FP_dir = dirname(dirname(pathof(_FP))) # Root directory of FlexPlan package
include(joinpath(_FP_dir,&quot;test/io/sol.jl&quot;))</code></pre><p>and import the required packages.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../examples/">« Examples</a><a class="docs-footer-nextpage" href="../problem_types/">Problem types »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Wednesday 14 June 2023 03:56">Wednesday 14 June 2023</span>. Using Julia version 1.9.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
